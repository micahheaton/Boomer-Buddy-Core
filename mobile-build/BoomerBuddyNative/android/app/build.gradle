apply plugin: "com.android.application"
apply plugin: "org.jetbrains.kotlin.android"
apply plugin: "com.facebook.react"

/**
 * Boomer Buddy Native - Android Build Configuration
 * Production-ready APK with system-level permissions
 */

def projectRoot = rootDir.getAbsoluteFile().getParentFile().getAbsolutePath()

android {
    compileSdkVersion 34
    buildToolsVersion "34.0.0"
    
    namespace "com.boomerbuddynative"

    defaultConfig {
        applicationId "com.boomerbuddynative"
        minSdkVersion 24
        targetSdkVersion 34
        versionCode 1
        versionName "2.0.0"
        
        testInstrumentationRunner "androidx.test.runner.AndroidJUnitRunner"
        
        // Enable multidex support
        multiDexEnabled true
        
        // Native library architecture
        ndk {
            abiFilters "armeabi-v7a", "arm64-v8a", "x86", "x86_64"
        }
    }

    buildTypes {
        debug {
            debuggable true
            applicationIdSuffix ".debug"
            versionNameSuffix "-debug"
        }
        
        release {
            minifyEnabled true
            proguardFiles getDefaultProguardFile("proguard-android-optimize.txt"), "proguard-rules.pro"
            
            // Signing config for production
            signingConfig signingConfigs.debug // Use debug for now, replace with production keys
        }
    }

    compileOptions {
        sourceCompatibility JavaVersion.VERSION_11
        targetCompatibility JavaVersion.VERSION_11
    }

    kotlinOptions {
        jvmTarget = "11"
    }

    packagingOptions {
        pickFirst "lib/x86/libc++_shared.so"
        pickFirst "lib/x86_64/libc++_shared.so"
        pickFirst "lib/arm64-v8a/libc++_shared.so"
        pickFirst "lib/armeabi-v7a/libc++_shared.so"
        
        exclude "META-INF/DEPENDENCIES"
        exclude "META-INF/LICENSE"
        exclude "META-INF/LICENSE.txt"
        exclude "META-INF/NOTICE"
        exclude "META-INF/NOTICE.txt"
    }
}

dependencies {
    implementation "androidx.core:core-ktx:1.12.0"
    implementation "androidx.appcompat:appcompat:1.6.1"
    implementation "com.google.android.material:material:1.11.0"
    implementation "androidx.constraintlayout:constraintlayout:2.1.4"
    
    // React Native
    implementation "com.facebook.react:react-android"
    implementation "com.facebook.react:flipper-integration"
    
    // Multidex support
    implementation "androidx.multidex:multidex:2.0.1"
    
    // Testing
    testImplementation "junit:junit:4.13.2"
    androidTestImplementation "androidx.test.ext:junit:1.1.5"
    androidTestImplementation "androidx.test.espresso:espresso-core:3.5.1"
    
    if (hermesEnabled.toBoolean()) {
        implementation("com.facebook.react:hermes-android")
    } else {
        implementation jscFlavor
    }
}

react {
    bundleCommand = "bundle"
    entryFile = "index.js"
    bundleConfig = projectRoot + "/metro.config.js"
    bundleInDebug = false
    bundleInRelease = true
    
    hermesCommand = "../../node_modules/react-native/sdks/hermesc/%OS-BIN%/hermesc"
    hermesFlags = ["-O", "-output-source-map"]
}